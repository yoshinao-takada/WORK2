<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="773px" preserveAspectRatio="none" style="width:596px;height:773px;" version="1.1" viewBox="0 0 596 773" width="596px" zoomAndPan="magnify"><defs><filter height="300%" id="f1f4wnijysotnc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1f4wnijysotnc)" height="582.4609" style="stroke:#000000;stroke-width:2.0;" width="573" x="9" y="114.9609"/><rect fill="#FFFFFF" filter="url(#f1f4wnijysotnc)" height="191.5938" style="stroke:#000000;stroke-width:2.0;" width="234" x="19" y="183.6641"/><rect fill="#FFFFFF" height="89.5391" style="stroke:none;stroke-width:1.0;" width="234" x="19" y="285.7188"/><rect fill="#FFFFFF" filter="url(#f1f4wnijysotnc)" height="301.1641" style="stroke:#000000;stroke-width:2.0;" width="389" x="183" y="389.2578"/><rect fill="#FFFFFF" filter="url(#f1f4wnijysotnc)" height="238.4609" style="stroke:#000000;stroke-width:2.0;" width="356" x="206" y="444.9609"/><rect fill="#FFFFFF" filter="url(#f1f4wnijysotnc)" height="79.0547" style="stroke:#000000;stroke-width:2.0;" width="303.5" x="248.5" y="513.6641"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="92" x2="92" y1="54.6094" y2="714.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="218" x2="218" y1="54.6094" y2="714.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="288.5" x2="288.5" y1="54.6094" y2="714.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="438" x2="438" y1="54.6094" y2="714.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="513" x2="513" y1="54.6094" y2="714.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="68" y="51.5332">reader</text><ellipse cx="92" cy="21" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="88,9,94,4,92,9,94,14,88,9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="68" y="727.9551">reader</text><ellipse cx="92" cy="747.0313" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="88,735.0313,94,730.0313,92,735.0313,94,740.0313,88,735.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="193" y="51.5332">ringbuf</text><ellipse cx="218" cy="21" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="206" x2="230" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="193" y="727.9551">ringbuf</text><ellipse cx="218" cy="747.0313" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="206" x2="230" y1="761.0313" y2="761.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="258.5" y="51.5332">packeter</text><ellipse cx="289" cy="21" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="285,9,291,4,289,9,291,14,285,9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="258.5" y="727.9551">packeter</text><ellipse cx="289" cy="747.0313" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="285,735.0313,291,730.0313,289,735.0313,291,740.0313,285,735.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="402" y="51.5332">dispatcher</text><ellipse cx="438" cy="21" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="426" x2="450" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="402" y="727.9551">dispatcher</text><ellipse cx="438" cy="747.0313" fill="#FEFECE" filter="url(#f1f4wnijysotnc)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="426" x2="450" y1="761.0313" y2="761.0313"/><rect fill="#FEFECE" filter="url(#f1f4wnijysotnc)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="484" y="18"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="491" y="39.5332">clients</text><rect fill="#FEFECE" filter="url(#f1f4wnijysotnc)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="484" y="713.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="491" y="734.9551">clients</text><line style="stroke:#A80036;stroke-width:1.0;" x1="92" x2="134" y1="86.9609" y2="86.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="134" x2="134" y1="86.9609" y2="99.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="93" x2="134" y1="99.9609" y2="99.9609"/><polygon fill="#A80036" points="103,95.9609,93,99.9609,103,103.9609,99,99.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="99" y="82.1045">mark = begin_mark</text><path d="M9,114.9609 L82,114.9609 L82,122.9609 L72,132.9609 L9,132.9609 L9,114.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="582.4609" style="stroke:#000000;stroke-width:2.0;" width="573" x="9" y="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="24" y="129.4561">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="97" y="128.3799">[until end_request]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="92" x2="134" y1="155.6641" y2="155.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="134" x2="134" y1="155.6641" y2="168.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="93" x2="134" y1="168.6641" y2="168.6641"/><polygon fill="#A80036" points="103,164.6641,93,168.6641,103,172.6641,99,168.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="99" y="150.8076">try-read</text><path d="M19,183.6641 L80,183.6641 L80,191.6641 L70,201.6641 L19,201.6641 L19,183.6641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="191.5938" style="stroke:#000000;stroke-width:2.0;" width="234" x="19" y="183.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="34" y="198.1592">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51" x="95" y="197.083">[no_data]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="92" x2="134" y1="224.3672" y2="224.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="134" x2="134" y1="224.3672" y2="237.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="93" x2="134" y1="237.3672" y2="237.3672"/><polygon fill="#A80036" points="103,233.3672,93,237.3672,103,241.3672,99,237.3672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="99" y="219.5107">mark = begin_mark</text><path d="M29,250.3672 L29,276.3672 L150,276.3672 L150,260.3672 L140,250.3672 L29,250.3672 " fill="#FBFB77" filter="url(#f1f4wnijysotnc)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M140,250.3672 L140,260.3672 L150,260.3672 L140,250.3672 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="35" y="268.8623">sleep 1-byte time</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="19" x2="253" y1="286.7188" y2="286.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="24" y="298.1377">[with_data]</text><polygon fill="#A80036" points="206,319.9063,216,323.9063,206,327.9063,210,323.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="92" x2="212" y1="323.9063" y2="323.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="99" y="319.0498">put with mark</text><line style="stroke:#A80036;stroke-width:1.0;" x1="92" x2="134" y1="354.2578" y2="354.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="134" x2="134" y1="354.2578" y2="367.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="93" x2="134" y1="367.2578" y2="367.2578"/><polygon fill="#A80036" points="103,363.2578,93,367.2578,103,371.2578,99,367.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="99" y="349.4014">mark = no_mark</text><path d="M183,389.2578 L256,389.2578 L256,397.2578 L246,407.2578 L183,407.2578 L183,389.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="301.1641" style="stroke:#000000;stroke-width:2.0;" width="389" x="183" y="389.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="198" y="403.7529">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="271" y="402.6768">[until ringbuf empty]</text><polygon fill="#A80036" points="229,425.9609,219,429.9609,229,433.9609,225,429.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="223" x2="288" y1="429.9609" y2="429.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="235" y="425.1045">get data</text><path d="M206,444.9609 L267,444.9609 L267,452.9609 L257,462.9609 L206,462.9609 L206,444.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="238.4609" style="stroke:#000000;stroke-width:2.0;" width="356" x="206" y="444.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="221" y="459.4561">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="282" y="458.3799">[packeter has data]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="331" y1="485.6641" y2="485.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="331" x2="331" y1="485.6641" y2="498.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="290" x2="331" y1="498.6641" y2="498.6641"/><polygon fill="#A80036" points="300,494.6641,290,498.6641,300,502.6641,296,498.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="296" y="480.8076">parse data</text><path d="M248.5,513.6641 L309.5,513.6641 L309.5,521.6641 L299.5,531.6641 L248.5,531.6641 L248.5,513.6641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:2.0;" width="303.5" x="248.5" y="513.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="263.5" y="528.1592">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="103" x="324.5" y="527.083">[complete_packet]</text><polygon fill="#A80036" points="426,550.3672,436,554.3672,426,558.3672,430,554.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="432" y1="554.3672" y2="554.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="296" y="549.5107">the completed packet</text><polygon fill="#A80036" points="501,580.7188,511,584.7188,501,588.7188,505,584.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="507" y1="584.7188" y2="584.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="445" y="579.8623">dispatch</text><line style="stroke:#A80036;stroke-width:1.0;" x1="289" x2="331" y1="622.0703" y2="622.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="331" x2="331" y1="622.0703" y2="635.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="290" x2="331" y1="635.0703" y2="635.0703"/><polygon fill="#A80036" points="300,631.0703,290,635.0703,300,639.0703,296,635.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="296" y="617.2139">estimate sleep time</text><path d="M216,648.0703 L216,674.0703 L358,674.0703 L358,658.0703 L348,648.0703 L216,648.0703 " fill="#FBFB77" filter="url(#f1f4wnijysotnc)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M348,648.0703 L348,658.0703 L358,658.0703 L348,648.0703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="222" y="666.5654">sleep estimated time</text><!--MD5=[01d90a07aa3e05110db260e1980acd19]
@startuml
control reader
entity ringbuf
control packeter
entity dispatcher
participant clients
reader -> reader : mark = begin_mark
loop until end_request
    reader -> reader : try-read
    alt no_data
        reader -> reader : mark = begin_mark
        note over reader: sleep 1-byte time
    else with_data
        reader -> ringbuf : put with mark
        reader -> reader : mark = no_mark
    end
    loop until ringbuf empty
        ringbuf <- packeter : get data
        alt packeter has data
            packeter -> packeter : parse data
            alt complete_packet
                packeter -> dispatcher : the completed packet
                dispatcher -> clients : dispatch
            end
            packeter -> packeter : estimate sleep time
            note over packeter : sleep estimated time
        end
    end
end
@enduml

PlantUML version 1.2021.00(Sun Jan 10 19:25:05 JST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>